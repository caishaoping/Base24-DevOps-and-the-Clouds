# Use resolvconf to permanatly set DNS server in /etc/resolv.conf

## Install resolvconf package
vagrant@worker:~$ sudo apt install resolvconf
Reading package lists... Done
Building dependency tree
Reading state information... Done
The following NEW packages will be installed:
  resolvconf
0 upgraded, 1 newly installed, 0 to remove and 3 not upgraded.
Need to get 54.7 kB of archives.
After this operation, 200 kB of additional disk space will be used.
Get:1 http://in.archive.ubuntu.com/ubuntu focal/universe amd64 resolvconf all 1.82 [54.7 kB]
Fetched 54.7 kB in 0s (207 kB/s)
Preconfiguring packages ...
Selecting previously unselected package resolvconf.
(Reading database ... 47827 files and directories currently installed.)
Preparing to unpack .../resolvconf_1.82_all.deb ...
Unpacking resolvconf (1.82) ...
Setting up resolvconf (1.82) ...
Created symlink /etc/systemd/system/sysinit.target.wants/resolvconf.service → /lib/systemd/system/resolvconf.service.
Created symlink /etc/systemd/system/systemd-resolved.service.wants/resolvconf-pull-resolved.path → /lib/systemd/system/resolvconf-pull-resolved.path.
resolvconf-pull-resolved.service is a disabled or a static unit, not starting it.
Processing triggers for systemd (245.4-4ubuntu3.17) ...
Processing triggers for man-db (2.9.1-1) ...
Processing triggers for resolvconf (1.82) ...
vagrant@worker:~$
vagrant@worker:~$


## Update /etc/resolv.conf

### Before Update
vagrant@worker:~$ cat /etc/resolv.conf
comment # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
comment #     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
comment # 127.0.0.53 is the systemd-resolved stub resolver.
comment # run "systemd-resolve --status" to see details about the actual nameservers.

nameserver 127.0.0.53
options edns0 trust-ad
vagrant@worker:~$

### Update via edit
sudo vim /etc/resolv.conf

## After Update
vagrant@worker:~$ cat /etc/resolv.conf
comment # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
comment #     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
comment # 127.0.0.53 is the systemd-resolved stub resolver.
comment # run "systemd-resolve --status" to see details about the actual nameservers.

nameserver 127.0.0.53
options edns0 trust-ad
vagrant@worker:~$ sudo vim /etc/resolv.conf
vagrant@worker:~$ cat /etc/resolv.conf
comment # Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
comment #     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
comment # 127.0.0.53 is the systemd-resolved stub resolver.
comment # run "systemd-resolve --status" to see details about the actual nameservers.

nameserver 8.8.8.8
nameserver 1.1.1.1
nameserver 127.0.0.53
options edns0 trust-ad
vagrant@worker:~$

## start resolvconf.service
vagrant@worker:~$ sudo systemctl start resolvconf.service

## Enable resolvconf.service
vagrant@worker:~$ sudo systemctl enable resolvconf.service
Synchronizing state of resolvconf.service with SysV service script with /lib/systemd/systemd-sysv-install.
Executing: /lib/systemd/systemd-sysv-install enable resolvconf
vagrant@worker:~$

## Update /etc/resolvconf/resolv.conf.d/head
vagrant@worker:~$ cat /etc/resolvconf/resolv.conf.d/head
/# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
/#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
/# 127.0.0.53 is the systemd-resolved stub resolver.
/# run "systemd-resolve --status" to see details about the actual nameservers.

vagrant@worker:~$ sudo vim /etc/resolvconf/resolv.conf.d/head
vagrant@worker:~$ cat /etc/resolvconf/resolv.conf.d/head
/# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
/#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
/# 127.0.0.53 is the systemd-resolved stub resolver.
/# run "systemd-resolve --status" to see details about the actual nameservers.

nameserver 8.8.8.8
nameserver 1.1.1.1
vagrant@worker:~$

## Restart resolvconf.service
vagrant@worker:~$ sudo systemctl restart resolvconf.service
vagrant@worker:~$
vagrant@worker:~$

## Use DIG to verify the change in DNA service 
vagrant@worker:~$ dig google.com

; <<>> DiG 9.16.1-Ubuntu <<>> google.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 26793
;; flags: qr rd ra; QUERY: 1, ANSWER: 6, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 512
;; QUESTION SECTION:
;google.com.                    IN      A

;; ANSWER SECTION:
google.com.             222     IN      A       142.250.115.138
google.com.             222     IN      A       142.250.115.102
google.com.             222     IN      A       142.250.115.100
google.com.             222     IN      A       142.250.115.113
google.com.             222     IN      A       142.250.115.101
google.com.             222     IN      A       142.250.115.139

;; Query time: 8 msec
;; SERVER: 8.8.8.8#53(8.8.8.8)
;; WHEN: Wed Sep 14 00:37:18 UTC 2022
;; MSG SIZE  rcvd: 135

## Confirmed the new DNS of SERVER: 8.8.8.8#53(8.8.8.8)

